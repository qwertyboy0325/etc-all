# 依賴庫介紹

本文檔詳細介紹 ETC 點雲標注系統後端使用的各種依賴庫，包括它們的用途、版本選擇原因和配置說明。

## 核心框架

### Web 框架
- **FastAPI 0.104.1**
  - 用途：現代、高性能的 Python Web 框架
  - 選擇原因：
    - 原生支援異步操作
    - 自動生成 OpenAPI/Swagger 文檔
    - 優秀的類型提示支援
    - 高性能，基於 Starlette 和 Pydantic
  - 核心功能：API 路由、請求驗證、響應序列化

- **Uvicorn 0.24.0**
  - 用途：ASGI 服務器
  - 選擇原因：
    - 支援異步操作
    - 高性能
    - 支援熱重載（開發環境）
  - 配置：包含 `standard` 版本，支援額外的性能優化組件

## 數據庫相關

### ORM 和數據庫驅動
- **SQLAlchemy 2.0.23**
  - 用途：Python SQL 工具包和 ORM
  - 選擇原因：
    - 成熟穩定的 ORM 框架
    - 支援異步操作（2.0 版本）
    - 強大的查詢構造器
    - 支援多種數據庫
  - 功能：模型定義、關係映射、查詢構造

- **AsyncPG 0.29.0**
  - 用途：PostgreSQL 異步數據庫驅動
  - 選擇原因：
    - 高性能異步操作
    - 專為 PostgreSQL 優化
    - 支援連接池
  - 用途：生產環境數據庫連接

- **psycopg2-binary 2.9.9**
  - 用途：PostgreSQL 同步數據庫驅動
  - 選擇原因：
    - Alembic 遷移工具需要
    - 成熟穩定
    - 廣泛使用
  - 用途：數據庫遷移和某些同步操作

- **greenlet 3.2.3**
  - 用途：協程支援庫
  - 選擇原因：
    - SQLAlchemy 異步功能依賴
    - 提供輕量級協程支援
  - 功能：支援 SQLAlchemy 的異步操作

### 數據庫遷移
- **Alembic 1.12.1**
  - 用途：數據庫遷移工具
  - 選擇原因：
    - SQLAlchemy 官方遷移工具
    - 支援版本控制
    - 自動生成遷移腳本
  - 功能：數據庫結構變更管理

## 緩存和消息隊列

### Redis
- **Redis 5.0.1**
  - 用途：內存數據庫客戶端
  - 選擇原因：
    - 高性能緩存
    - 支援多種數據結構
    - 會話存儲
  - 功能：緩存、會話管理、Celery broker

### 異步任務隊列
- **Celery 5.3.4**
  - 用途：分佈式任務隊列
  - 選擇原因：
    - 成熟的異步任務處理框架
    - 支援多種 broker（Redis/RabbitMQ）
    - 豐富的監控和管理功能
  - 功能：點雲文件處理、郵件發送、背景任務

## 認證和安全

### JWT 和加密
- **python-jose[cryptography] 3.3.0**
  - 用途：JWT Token 處理
  - 選擇原因：
    - 支援多種 JWT 算法
    - 包含加密功能
    - 安全性好
  - 功能：JWT Token 生成和驗證

- **passlib[bcrypt] 1.7.4**
  - 用途：密碼哈希和驗證
  - 選擇原因：
    - 支援多種哈希算法
    - bcrypt 是安全的密碼哈希算法
    - 防彩虹表攻擊
  - 功能：用戶密碼安全存儲

### 文件上傳
- **python-multipart 0.0.6**
  - 用途：處理 multipart/form-data
  - 選擇原因：
    - FastAPI 文件上傳必需
    - 支援大文件上傳
  - 功能：點雲文件上傳處理

## 對象存儲

### 文件存儲
- **MinIO 7.2.0**
  - 用途：對象存儲客戶端
  - 選擇原因：
    - S3 兼容的對象存儲
    - 適合私有部署
    - 高性能文件存儲
  - 功能：點雲文件存儲

- **boto3 1.34.0**
  - 用途：AWS SDK for Python
  - 選擇原因：
    - 支援 AWS S3
    - 雲端部署時使用
    - 豐富的 AWS 服務支援
  - 功能：雲端文件存儲

## 配置管理

### 環境配置
- **python-dotenv 1.0.0**
  - 用途：環境變數管理
  - 選擇原因：
    - 簡化配置管理
    - 支援 .env 文件
    - 開發環境友好
  - 功能：載入環境變數

- **pydantic-settings 2.1.0**
  - 用途：設定驗證和管理
  - 選擇原因：
    - 類型安全的配置
    - 自動驗證配置值
    - 與 Pydantic 集成
  - 功能：應用程式設定管理

## HTTP 客戶端

### 異步 HTTP
- **httpx 0.25.2**
  - 用途：異步 HTTP 客戶端
  - 選擇原因：
    - 支援異步操作
    - 現代的 API 設計
    - 支援 HTTP/2
  - 功能：外部 API 調用、文件下載

## 數據處理

### 數值計算
- **NumPy 1.24.4**
  - 用途：數值計算庫
  - 選擇原因：
    - 點雲數據處理必需
    - 高性能數值計算
    - Python 科學計算生態基礎
  - 版本選擇：1.24.4 與 Python 3.11 兼容性最佳
  - 功能：點雲數據處理、數值計算

- **pandas 2.0.3**
  - 用途：數據分析庫
  - 選擇原因：
    - 強大的數據分析功能
    - 支援多種數據格式
    - 統計分析支援
  - 版本選擇：2.0.3 是穩定版本，支援 Python 3.11
  - 功能：數據統計、報表生成

## 開發工具

### 測試框架
- **pytest 7.4.3**
  - 用途：測試框架
  - 選擇原因：
    - Python 主流測試框架
    - 豐富的插件生態
    - 靈活的測試組織
  - 功能：單元測試、集成測試

- **pytest-asyncio 0.21.1**
  - 用途：異步測試支援
  - 選擇原因：
    - 支援測試異步函數
    - 與 pytest 完美集成
  - 功能：異步代碼測試

- **pytest-cov 4.1.0**
  - 用途：測試覆蓋率
  - 選擇原因：
    - 生成測試覆蓋率報告
    - 代碼質量監控
  - 功能：測試覆蓋率統計

### 代碼品質工具
- **Black 23.11.0**
  - 用途：代碼格式化工具
  - 選擇原因：
    - Python 官方推薦
    - 零配置代碼格式化
    - 統一代碼風格
  - 功能：自動代碼格式化

- **isort 5.12.0**
  - 用途：import 語句排序
  - 選擇原因：
    - 自動整理 import 順序
    - 提高代碼可讀性
    - 與 Black 兼容
  - 功能：import 語句自動排序

- **flake8 6.1.0**
  - 用途：代碼風格檢查
  - 選擇原因：
    - 綜合的代碼檢查工具
    - 支援 PEP 8 標準
    - 豐富的插件支援
  - 功能：代碼風格和語法檢查

- **mypy 1.7.1**
  - 用途：靜態類型檢查
  - 選擇原因：
    - 提高代碼質量
    - 早期發現類型錯誤
    - 與 FastAPI 類型提示集成
  - 功能：靜態類型檢查

### Git Hooks
- **pre-commit 3.6.0**
  - 用途：Git pre-commit hooks 管理
  - 選擇原因：
    - 自動化代碼品質檢查
    - 提交前代碼驗證
    - 團隊協作標準化
  - 功能：提交前自動運行代碼檢查

### 類型提示
- **types-redis 4.6.0.8**
  - 用途：Redis 類型提示
  - 選擇原因：提供 Redis 客戶端的類型提示支援

- **types-requests 2.31.0.10**
  - 用途：requests 庫類型提示
  - 選擇原因：提供 HTTP 請求的類型提示支援

## 版本選擇策略

### Python 3.11 兼容性
- 所有依賴都經過 Python 3.11 兼容性測試
- 選擇穩定版本，避免使用過新的版本
- NumPy 和 pandas 使用較保守的版本以確保穩定性

### 安全考量
- 密碼哈希使用 bcrypt 算法
- JWT Token 使用加密簽名
- 所有輸入都經過 Pydantic 驗證

### 性能優化
- 使用異步數據庫驅動（AsyncPG）
- Redis 作為高性能緩存
- Celery 處理耗時任務

### 開發體驗
- 完整的代碼品質工具鏈
- 自動化測試和覆蓋率
- 類型提示支援

## 依賴更新策略

### 定期更新
- 每季度檢查依賴更新
- 優先更新安全性修復
- 測試後再更新生產環境

### 版本固定
- 使用精確版本號（`==`）避免意外更新
- 重要依賴版本鎖定
- 測試環境先行驗證

### 相容性測試
- 更新前進行完整測試
- 檢查 breaking changes
- 準備回滾計劃

## 部署考量

### 容器化
- 所有依賴支援容器化部署
- Docker 鏡像大小優化
- 多階段構建減少體積

### 性能監控
- 支援 APM 工具集成
- 數據庫連接池監控
- 緩存命中率統計

這個依賴架構為 ETC 點雲標注系統提供了：
- 🚀 高性能的異步處理能力
- 🔒 企業級的安全保障
- 🧪 完善的開發和測試工具
- 📊 強大的數據處理能力
- 🔧 靈活的配置和部署選項 