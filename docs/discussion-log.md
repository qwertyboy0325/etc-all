# 討論記錄

## 討論記錄格式說明

每個討論記錄應包含：
- 日期和時間
- 參與者
- 討論主題
- 討論內容摘要
- 決策結果
- 後續行動

---

## 2024年討論記錄

### 討論 #001 - 專案需求確認
**日期：** 2024年12月19日  
**參與者：** Ezra4, Claude AI  
**主題：** 點雲標注系統專案需求討論  

**討論內容：**
- **專案背景**：ETC主導的專案，使用光達掃描的點雲數據進行車種辨識訓練
- **核心需求**：建立點雲標注網頁系統，讓標注人員在瀏覽器中辨識車種
- **數據格式**：NumPy格式（.npy/.npz），文件大小約10MB以內
- **數據特性**：靜態點雲，無顏色信息，純點坐標數據
- **數據傳輸**：透過消息隊列傳送
- **標注方式**：文字分類標注（非幾何標注），點雲會預處理濾除非交通工具
- **權限需求**：管理員、標注員、審核員、查看者四種角色
- **工作流程**：多人標注 + 任務分發系統 + 審核流程
- **分類系統**：需要動態可調整的車種分類

**決策結果：**
- 採用避免造輪子的策略，使用現成框架組合
- 前端：React + Three.js + Ant Design
- 後端：FastAPI + Celery + Redis
- 資料庫：PostgreSQL + Redis + MinIO/S3
- 權限：FastAPI-Users + JWT + RBAC

**後續行動：**
- [ ] 細化技術架構設計
- [ ] 確認點雲渲染效能解決方案
- [ ] 設計任務分發系統
- [ ] 設計審核工作流
- [ ] 規劃開發優先順序

---

### 討論 #002 - 技術架構細化
**日期：** 2024年12月19日  
**參與者：** Ezra4, Claude AI  
**主題：** 技術架構和實作細節討論  

**討論內容：**
**澄清職責範圍：**
- 前處理和訓練端不是我們負責，重點是標注網頁功能
- 需要重新評估哪些優化是必要的，哪些是過度設計

**點雲渲染策略調整：**
- 基礎方案：直接渲染NumPy點雲，做基本的WebGL優化
- 必要優化：loading動畫、基本的視角控制、錯誤處理
- 可選優化：複雜的LOD、Octree等（如果性能真的有問題再考慮）

**技術重點重新定位：**
1. 穩定的點雲文件載入和顯示
2. 簡潔直觀的標注界面
3. 可靠的任務分發和狀態管理
4. 完善的權限和審核系統

**決策結果：**
- 採用「最簡可行方案」(MVP)策略
- 先做核心功能，性能優化按需實施
- 重點關注用戶體驗和業務邏輯

**後續行動：**
- [ ] 重新定義MVP功能範圍
- [ ] 確認點雲文件的實際大小和格式
- [ ] 設計簡化的標注界面原型
- [ ] 規劃分階段開發計劃

---

### 討論 #003 - 多專案架構設計
**日期：** 2024年12月19日  
**參與者：** Ezra4, Claude AI  
**主題：** 多專案支援架構設計討論  

**討論內容：**
**需求確認：**
- 系統需要支援多個專案同時運行
- 用戶可以同時參與多個專案，但在不同專案中有不同權限
- 專案之間需要邏輯隔離，但不需要完全物理隔離
- 車種分類可以在專案間共享，但專案可以獨立新增分類
- 需要跨專案的統計報表功能

**技術方案討論：**
- **資料隔離策略**：邏輯隔離 vs 物理隔離
  - 物理隔離：每個專案獨立資料庫，安全性高但維護複雜
  - 邏輯隔離：共享資料庫，用專案ID區分，便於跨專案統計
- **權限系統**：專案級別的角色權限系統
- **車種分類**：全局分類 + 專案特定分類的混合模式

**決策結果：**
- 採用邏輯隔離策略，在資料庫層面以專案ID區分數據
- 實施專案級別的權限系統，用戶在不同專案中可有不同角色
- 車種分類採用全局模板+專案特定的混合模式
- 支援跨專案統計報表功能

**架構變更：**
- 所有核心資料表（tasks, annotations等）新增project_id欄位
- 新增專案管理模組和專案成員關係表
- 新增全局車種分類和專案車種分類表
- 權限檢查邏輯升級為專案感知模式

**後續行動：**
- [x] 創建多專案架構文檔
- [x] 更新後端架構設計文檔
- [ ] 設計資料庫遷移方案
- [ ] 更新前端架構以支援專案切換
- [ ] 設計跨專案統計報表功能

---

## 討論主題標籤

### 技術相關
- #技術選型 ✓
- #架構設計 ✓
- #多專案架構 ✓
- #性能優化
- #安全考量
- #點雲渲染
- #任務分發系統
- #審核工作流
- #資料庫設計 ✓
- #權限系統 ✓

### 業務相關
- #需求分析 ✓
- #功能規劃 ✓
- #用戶體驗
- #業務邏輯
- #權限管理 ✓
- #工作流程
- #專案管理 ✓
- #多專案支援 ✓

### 管理相關
- #專案管理
- #時程規劃
- #資源分配
- #風險管理

## 重要決策摘要

### 技術決策
| 決策項目 | 決策結果 | 決策日期 | 相關討論 |
|----------|----------|----------|----------|
| 前端框架 | React + Three.js | 2024-12-19 | 討論 #001 |
| 後端框架 | FastAPI | 2024-12-19 | 討論 #001 |
| 資料庫 | PostgreSQL + Redis + MinIO | 2024-12-19 | 討論 #001 |
| 權限系統 | FastAPI-Users + JWT + RBAC | 2024-12-19 | 討論 #001 |
| 任務隊列 | Celery + Redis | 2024-12-19 | 討論 #001 |
| 多專案架構 | 邏輯隔離策略 | 2024-12-19 | 討論 #003 |
| 資料隔離方案 | 邏輯隔離（共享資料庫） | 2024-12-19 | 討論 #003 |
| 車種分類系統 | 全局模板+專案特定混合 | 2024-12-19 | 討論 #003 |

### 業務決策
| 決策項目 | 決策結果 | 決策日期 | 相關討論 |
|----------|----------|----------|----------|
| 核心功能 | 點雲標注 + 任務分發 + 審核流程 | 2024-12-19 | 討論 #001 |
| 目標用戶 | 標注員、審核員、管理員、查看者 | 2024-12-19 | 討論 #001 |
| 標注方式 | 文字分類標注 | 2024-12-19 | 討論 #001 |
| 部署策略 | 內網部署 → 雲端部署 | 2024-12-19 | 討論 #001 |
| 多專案支援 | 支援多專案並行運作 | 2024-12-19 | 討論 #003 |
| 專案權限模式 | 專案級別獨立權限 | 2024-12-19 | 討論 #003 |
| 跨專案統計 | 支援跨專案報表功能 | 2024-12-19 | 討論 #003 |

---
*最後更新：2024年12月19日*
*多專案架構更新：2024年12月19日* 