# é»é›²æ¨™è¨»ç³»çµ± â†’ PointNet è¨“ç·´æ•´åˆæŒ‡å—

## ç›®éŒ„
1. [ç³»çµ±æ¶æ§‹æ¦‚è¦½](#1-ç³»çµ±æ¶æ§‹æ¦‚è¦½)
2. [æ•¸æ“šæ ¼å¼è¦ç¯„](#2-æ•¸æ“šæ ¼å¼è¦ç¯„)
3. [å®Œæ•´å·¥ä½œæµç¨‹](#3-å®Œæ•´å·¥ä½œæµç¨‹)
4. [è¨“ç·´æ¨¡å‹](#4-è¨“ç·´æ¨¡å‹)
5. [UI/UX é«”é©—æµç¨‹](#5-uiux-é«”é©—æµç¨‹)
6. [æŠ€è¡“ç´°ç¯€](#6-æŠ€è¡“ç´°ç¯€)
7. [ç–‘é›£æ’è§£](#7-ç–‘é›£æ’è§£)
8. [æ€§èƒ½å„ªåŒ–å»ºè­°](#8-æ€§èƒ½å„ªåŒ–å»ºè­°)

---

## 1. ç³»çµ±æ¶æ§‹æ¦‚è¦½

æœ¬ç³»çµ±å°‡é»é›²æ¨™è¨»å¹³å°èˆ‡ PointNet è¨“ç·´ç³»çµ±å®Œæ•´æ•´åˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ¨™è¨»ç³»çµ± (Backend)                     â”‚
â”‚  FastAPI + PostgreSQL + MinIO + Celery + Redis          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ å°å‡ºæ•¸æ“š
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•¸æ“šè™•ç†å±¤ (worker.py)                       â”‚
â”‚  1. æŸ¥è©¢ SUBMITTED æ¨™æ³¨                                  â”‚
â”‚  2. æŒ‰è»Šè¼›é¡å‹åˆ†çµ„                                        â”‚
â”‚  3. 90/10 Train/Test åˆ†å‰²                                â”‚
â”‚  4. å°å‡ºç‚º .npz (åªåŒ…å« 'pts')                            â”‚
â”‚  5. å¾ 00000 é–‹å§‹é€£çºŒç·¨è™Ÿ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ æ¨™æº–åŒ–æ•¸æ“šæ ¼å¼
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PointNet è¨“ç·´ç³»çµ±                                 â”‚
â”‚  FETCdataLoader + train_classification.py                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.1 æ¨™è¨»ç³»çµ± (Backend)

- **ä½ç½®**: `/backend/`
- **åŠŸèƒ½**: é»é›²æ•¸æ“šä¸Šå‚³ã€æ¨™è¨»ã€å¯©æ ¸ã€å°å‡º
- **é—œéµçµ„ä»¶**:
  - `app/api/`: RESTful API
  - `app/worker.py`: Celery éåŒæ­¥ä»»å‹™ï¼ˆæ•¸æ“šå°å‡ºï¼‰
  - `app/services/`: æ¥­å‹™é‚è¼¯å±¤

### 1.2 è¨“ç·´ç³»çµ± (PointNet)

- **ä½ç½®**: `/PointNet/`
- **åŠŸèƒ½**: PointNet æ·±åº¦å­¸ç¿’æ¨¡å‹è¨“ç·´
- **é—œéµçµ„ä»¶**:
  - `data_utils/FETCdataLoader.py`: è‡ªå®šç¾©æ•¸æ“šåŠ è¼‰å™¨
  - `train_classification.py`: è¨“ç·´è…³æœ¬
  - `test_classification.py`: æ¸¬è©¦è…³æœ¬
  - æ”¯æ´ä¸‰ç¨®æ¡æ¨£æ–¹å¼: `uniform`, `farthest`, `random`

---

## 2. æ•¸æ“šæ ¼å¼è¦ç¯„

### 2.1 FETCdataLoader æ•¸æ“šæ ¼å¼è¦æ±‚

**ç›®éŒ„çµæ§‹** (å¿…é ˆåš´æ ¼éµå®ˆ):
```
data_dir/
â”œâ”€â”€ vehicle_type_1/
â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â”œâ”€â”€ vehicle_type_1_00000.npz  â† å¾ 0 é–‹å§‹
â”‚   â”‚   â”œâ”€â”€ vehicle_type_1_00001.npz
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ vehicle_type_1_00000.npz  â† å¾ 0 é–‹å§‹
â”‚       â””â”€â”€ ...
â”œâ”€â”€ vehicle_type_2/
â”‚   â”œâ”€â”€ train/
â”‚   â””â”€â”€ test/
â””â”€â”€ ...
```

**NPZ æ–‡ä»¶å…§å®¹**:
```python
{
    'pts': np.ndarray,      # é»é›²æ•¸æ“š (N, 3) - å¿…é ˆä¸”å”¯ä¸€
}
```

**é‡è¦**: PointNet çš„ `FETCdataLoader` æœƒå¾**ç›®éŒ„åç¨±**è®€å–é¡åˆ¥æ¨™ç±¤ï¼Œä¸éœ€è¦åœ¨ NPZ æ–‡ä»¶ä¸­åŒ…å« `car_type` æ¬„ä½ã€‚

**é—œéµé…ç½®**:
- æª”åæ ¼å¼: `{vehicle_type}_{åºè™Ÿ:05d}.npz` (ä¾‹å¦‚: `bus_00000.npz`)
- **åºè™Ÿå¾ 0 é–‹å§‹**ï¼Œé€£çºŒç·¨è™Ÿ
- Train/Test æ¯”ä¾‹: **90/10** (PointNet æ¨™æº–é…ç½®)

### 2.2 å°å‡ºç¯„ä¾‹

åŸ·è¡Œè™•ç†å¾Œçš„æ•¸æ“šçµæ§‹ï¼š
```
/app/exports/project_abc123_20240115/
â”œâ”€â”€ bus/
â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â”œâ”€â”€ bus_00000.npz
â”‚   â”‚   â”œâ”€â”€ bus_00001.npz
â”‚   â”‚   â””â”€â”€ ... (ç´„ 450 å€‹æª”æ¡ˆï¼Œå¦‚æœç¸½å…± 500 å€‹)
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ bus_00000.npz
â”‚       â”œâ”€â”€ bus_00001.npz
â”‚       â””â”€â”€ ... (ç´„ 50 å€‹æª”æ¡ˆ)
â”œâ”€â”€ truck/
â”‚   â”œâ”€â”€ train/
â”‚   â””â”€â”€ test/
â””â”€â”€ sedan/
    â”œâ”€â”€ train/
    â””â”€â”€ test/
```

---

## 3. å®Œæ•´å·¥ä½œæµç¨‹

### æ­¥é©Ÿ 1: æ¨™æ³¨æ•¸æ“š (å‰ç«¯ UI)

1. ç™»å…¥ç³»çµ±
2. é¸æ“‡é …ç›®
3. ä¸Šå‚³é»é›²æª”æ¡ˆ (.npz)
4. é€²è¡Œæ¨™è¨»
   - é¸æ“‡è»Šè¼›é¡å‹
   - ä¿å­˜æ¨™è¨»ï¼ˆç‹€æ…‹: DRAFTï¼‰
5. æäº¤æ¨™è¨»ï¼ˆç‹€æ…‹: SUBMITTED â†’ è¦–ç‚ºå·²å®Œæˆï¼‰

### æ­¥é©Ÿ 2: æ•¸æ“šè™•ç† (è™•ç†ä¸­å¿ƒ)

1. é€²å…¥ã€Œè™•ç†ä¸­å¿ƒã€
2. æŸ¥çœ‹å¾…è™•ç†æ¨™è¨»åˆ—è¡¨
3. é¸æ“‡é …ç›®
4. é»æ“Šã€Œé–‹å§‹è™•ç†ã€æŒ‰éˆ•
5. **å¾Œç«¯è‡ªå‹•åŸ·è¡Œ**:
   ```python
   # Celery éåŒæ­¥ä»»å‹™
   - æŸ¥è©¢æ‰€æœ‰ SUBMITTED æ¨™æ³¨
   - æŒ‰è»Šè¼›é¡å‹åˆ†çµ„
   - 90/10 åˆ†å‰² train/test
   - å°å‡ºç‚º .npz (åªåŒ…å« 'pts')
   - å¾ 00000 é–‹å§‹ç·¨è™Ÿ
   - æ›´æ–°è™•ç†ç‹€æ…‹
   ```
6. å‰ç«¯é¡¯ç¤ºè™•ç†é€²åº¦
   - è™•ç†ä¸­: é¡¯ç¤º Loading åœ–ç¤º
   - å®Œæˆ: é¡¯ç¤ºã€Œè™•ç†å·²å®Œæˆï¼ã€è¨Šæ¯
   - è‡ªå‹•åˆ·æ–°å¾…è™•ç†åˆ—è¡¨

### æ­¥é©Ÿ 3: è¨“ç·´æ¨¡å‹

#### æ–¹æ³• 1: ç›´æ¥ä½¿ç”¨ PointNet è¨“ç·´è…³æœ¬ (æ¨è–¦)

```bash
# åˆ‡æ›åˆ° PointNet ç›®éŒ„
cd PointNet

# åŸ·è¡Œè¨“ç·´
python train_classification.py \
  --data_dir /path/to/exported/data \
  --log_dir pointnet_cls_fetc \
  --gpu 0 \
  --epoch 200 \
  --batch_size 24 \
  --num_point 1024 \
  --sampler uniform \
  --process_data \
  --clear_log
```

#### æ–¹æ³• 2: ä½¿ç”¨æ•´åˆè…³æœ¬

```bash
# åœ¨ backend ç›®éŒ„åŸ·è¡Œ
cd backend
python train_model.py \
  --data_dir /path/to/exported/data \
  --epoch 200 \
  --gpu 0 \
  --sampler uniform \
  --process_data \
  --clear_log
```

#### åƒæ•¸èªªæ˜

| åƒæ•¸ | èªªæ˜ | é è¨­å€¼ |
|------|------|--------|
| `--data_dir` | å°å‡ºæ•¸æ“šçš„è·¯å¾‘ | å¿…å¡« |
| `--log_dir` | æ—¥èªŒç›®éŒ„åç¨± | `pointnet_cls_fetc` |
| `--model` | æ¨¡å‹åç¨± | `pointnet_cls` |
| `--epoch` | è¨“ç·´è¼ªæ•¸ | `200` |
| `--batch_size` | æ‰¹æ¬¡å¤§å° | `24` |
| `--num_point` | æ¯å€‹é»é›²çš„é»æ•¸ | `1024` |
| `--sampler` | æ¡æ¨£æ–¹å¼ (uniform/farthest/random) | `uniform` |
| `--gpu` | GPU è¨­å‚™ç·¨è™Ÿ | `0` |
| `--process_data` | é›¢ç·šè™•ç†æ•¸æ“šï¼ˆé¦–æ¬¡è¨“ç·´å»ºè­°é–‹å•Ÿï¼‰ | `False` |
| `--clear_log` | æ¸…é™¤ä¹‹å‰çš„æ—¥èªŒ | `False` |

**è¨“ç·´æ—¥èªŒä½ç½®**:
- `PointNet/log/classification/{log_dir}/`
  - `checkpoints/`: æ¨¡å‹æª¢æŸ¥é»
  - `logs/`: è¨“ç·´æ—¥èªŒ

---

## 4. è¨“ç·´æ¨¡å‹

### 4.1 ç’°å¢ƒæº–å‚™

```bash
# 1. é€²å…¥ PointNet ç›®éŒ„
cd PointNet

# 2. å‰µå»º conda ç’°å¢ƒï¼ˆå¦‚æœå°šæœªå‰µå»ºï¼‰
conda env create -f environment.yaml

# 3. æ¿€æ´»ç’°å¢ƒ
conda activate pointnet

# 4. é©—è­‰ç’°å¢ƒ
python -c "import torch; print('PyTorch:', torch.__version__)"
python -c "from data_utils.FETCdataLoader import FETCdataLoader; print('FETCdataLoader: OK')"
```

### 4.2 é–‹å§‹è¨“ç·´

```bash
# åŸºæœ¬è¨“ç·´å‘½ä»¤
python train_classification.py \
  --data_dir /app/exports/project_abc123_20240115 \
  --log_dir pointnet_cls_fetc \
  --gpu 0 \
  --epoch 200 \
  --process_data \
  --clear_log

# é¦–æ¬¡è¨“ç·´å»ºè­°ä½¿ç”¨ --process_data ä¾†å¿«å–æ•¸æ“š
# å¾ŒçºŒè¨“ç·´å¯ä»¥ç§»é™¤æ­¤åƒæ•¸ä»¥åŠ å¿«å•Ÿå‹•é€Ÿåº¦
```

### 4.3 ç›£æ§è¨“ç·´

è¨“ç·´éç¨‹ä¸­ï¼Œä½ æœƒçœ‹åˆ°é¡ä¼¼çš„è¼¸å‡ºï¼š

```
Epoch 1/200:
[Train] Loss: 2.3456, Instance Acc: 0.45, Class Acc: 0.42
[Test]  Loss: 2.4567, Instance Acc: 0.43, Class Acc: 0.40
Best Instance Accuracy: 0.43

Epoch 50/200:
[Train] Loss: 0.5432, Instance Acc: 0.85, Class Acc: 0.83
[Test]  Loss: 0.6543, Instance Acc: 0.82, Class Acc: 0.80
Best Instance Accuracy: 0.82

...

Epoch 200/200:
[Train] Loss: 0.1234, Instance Acc: 0.95, Class Acc: 0.94
[Test]  Loss: 0.2345, Instance Acc: 0.92, Class Acc: 0.91
Best Instance Accuracy: 0.92
```

### 4.4 æ¨¡å‹è©•ä¼°

```bash
# ä½¿ç”¨æœ€ä½³æ¨¡å‹é€²è¡Œæ¸¬è©¦
python test_classification.py \
  --data_dir /app/exports/project_abc123_20240115 \
  --log_dir pointnet_cls_fetc

# è¼¸å‡ºç¯„ä¾‹ï¼š
# Test Instance Accuracy: 0.92
# Test Class Accuracy: 0.91
# Per-class accuracy:
#   bus: 0.95
#   truck: 0.90
#   sedan: 0.88
```

---

## 5. UI/UX é«”é©—æµç¨‹

### 5.1 ç”¨æˆ¶è§’è‰²

1. **æ¨™è¨»å“¡** (Annotator)
   - ä¸Šå‚³é»é›²æª”æ¡ˆ
   - æ¨™è¨»è»Šè¼›é¡å‹
   - æäº¤æ¨™è¨»

2. **è™•ç†å“¡** (Processor / åŸå¯©æ ¸å“¡)
   - æŸ¥çœ‹å¾…è™•ç†æ¨™è¨»
   - åŸ·è¡Œæ•¸æ“šè™•ç†
   - ç›£æ§è™•ç†ç‹€æ…‹

3. **ç®¡ç†å“¡** (Admin)
   - ç®¡ç†ç”¨æˆ¶
   - ç®¡ç†é …ç›®
   - æŸ¥çœ‹çµ±è¨ˆè³‡è¨Š

### 5.2 å®Œæ•´ UI æµç¨‹

#### æ¨™è¨»æµç¨‹

```
ç™»å…¥
  â†“
é¸æ“‡é …ç›®
  â†“
æ¨™è¨»é é¢
  â”œâ”€ å·¦å´: 3D é»é›²è¦–åœ–
  â”œâ”€ å³å´: æ¨™è¨»å·¥å…·
  â”‚   â”œâ”€ è»Šè¼›é¡å‹é¸æ“‡
  â”‚   â”œâ”€ ä¿å­˜è‰ç¨¿
  â”‚   â””â”€ æäº¤è™•ç†
  â””â”€ åº•éƒ¨: æª”æ¡ˆåˆ—è¡¨
      â”œâ”€ å·²å®Œæˆ (ç¶ è‰²)
      â””â”€ è‰ç¨¿ (ç°è‰²)
```

#### è™•ç†ä¸­å¿ƒæµç¨‹

```
è™•ç†ä¸­å¿ƒ
  â”œâ”€ çµ±è¨ˆå¡ç‰‡
  â”‚   â”œâ”€ ç¸½æ¨™è¨»æ•¸
  â”‚   â”œâ”€ å¾…è™•ç†æ•¸
  â”‚   â”œâ”€ å·²å®Œæˆæ•¸
  â”‚   â””â”€ å¹³å‡è³ªé‡
  â”œâ”€ é …ç›®é¸æ“‡
  â”‚   â””â”€ é¡¯ç¤ºè™•ç†ç‹€æ…‹ (Loading / Completed)
  â”œâ”€ æ¨™è¨»åˆ—è¡¨
  â”‚   â”œâ”€ é»é›²æª”æ¡ˆåç¨±
  â”‚   â”œâ”€ è»Šè¼›é¡å‹
  â”‚   â”œâ”€ æ¨™è¨»å“¡
  â”‚   â”œâ”€ æäº¤æ™‚é–“
  â”‚   â””â”€ ç‹€æ…‹æ¨™ç±¤
  â””â”€ é–‹å§‹è™•ç†æŒ‰éˆ•
      â”œâ”€ é»æ“Šå¾Œé¡¯ç¤º Loading
      â”œâ”€ æ¯ 2 ç§’è¼ªè©¢ç‹€æ…‹
      â”œâ”€ å®Œæˆå¾Œé¡¯ç¤ºæˆåŠŸè¨Šæ¯
      â””â”€ è‡ªå‹•åˆ·æ–°åˆ—è¡¨
```

### 5.3 ç‹€æ…‹åé¥‹è¨­è¨ˆ

| ç‹€æ…‹ | å‰ç«¯é¡¯ç¤º | é¡è‰² | åœ–ç¤º |
|------|----------|------|------|
| **DRAFT** | è‰ç¨¿ | ç°è‰² | ğŸ“ |
| **SUBMITTED** | å·²å®Œæˆ | ç¶ è‰² | âœ… |
| **è™•ç†ä¸­** | è™•ç†ä¸­... | è—è‰² | â³ (æ—‹è½‰) |
| **è™•ç†å®Œæˆ** | è™•ç†å·²å®Œæˆï¼ | ç¶ è‰² | âœ… |

---

## 6. æŠ€è¡“ç´°ç¯€

### 6.1 æ•¸æ“šå°å‡ºæµç¨‹

```python
# backend/app/worker.py
@celery_app.task
def export_dataset_async(project_id: str):
    # 1. æŸ¥è©¢æ‰€æœ‰ SUBMITTED æ¨™æ³¨ï¼ˆå·²ç§»é™¤ APPROVEDï¼‰
    # 2. æŒ‰è»Šè¼›é¡å‹åˆ†çµ„
    # 3. å‰µå»ºç›®éŒ„çµæ§‹: vehicle_type/train|test/
    # 4. 90/10 åˆ†å‰² train/test (PointNet æ¨™æº–)
    # 5. å°å‡ºç‚º .npz æ ¼å¼ï¼Œåƒ…åŒ…å« 'pts' æ¬„ä½
    # 6. æª”åå¾ 00000 é–‹å§‹ç·¨è™Ÿ
    # 7. æ›´æ–°é …ç›®è™•ç†ç‹€æ…‹
```

### 6.2 FETCdataLoader å·¥ä½œåŸç†

```python
# PointNet/data_utils/FETCdataLoader.py
class FETCdataLoader(Dataset):
    def __init__(self, root, args, split='train', process_data=False):
        # 1. æƒæ root ç›®éŒ„ä¸‹çš„æ‰€æœ‰å­ç›®éŒ„ä½œç‚ºé¡åˆ¥ï¼ˆå¾ç›®éŒ„åè®€å–ï¼‰
        # 2. åœ¨æ¯å€‹é¡åˆ¥ä¸‹çš„ train/ æˆ– test/ æŸ¥æ‰¾ .npz æ–‡ä»¶
        # 3. å»ºç«‹é¡åˆ¥åˆ°ç´¢å¼•çš„æ˜ å°„ (self.classes)
        # 4. å¯é¸ï¼šé›¢ç·šè™•ç†æ•¸æ“šä¸¦å¿«å–
        
    def __getitem__(self, index):
        # 1. è®€å– .npz æ–‡ä»¶ï¼ˆåªè®€å– 'pts' æ¬„ä½ï¼‰
        # 2. æ¡æ¨£é»é›²ï¼ˆuniform/farthest/randomï¼‰
        # 3. æ¨™æº–åŒ–é»é›²ï¼ˆä¸­å¿ƒåŒ–ï¼Œä¸ç¸®æ”¾ï¼‰
        # 4. è¿”å› (points, label_index)
```

**æ¡æ¨£ç­–ç•¥** (å¯é¸):
1. **uniform** (æ¨è–¦): ç­‰é–“è·æ¡æ¨£
   - é»æ•¸ < 1024: é‡è¤‡å¡«å……
   - é»æ•¸ > 1024: ç­‰é–“è·å–æ¨£
2. **farthest**: æœ€é é»æ¡æ¨£ (FPS)
3. **random**: éš¨æ©Ÿæ¡æ¨£

**æ¨™æº–åŒ–æ–¹æ³•**:
```python
def pc_normalize(pc):
    centroid = np.mean(pc, axis=0)
    pc = pc - centroid
    # æ³¨æ„ï¼šä¸é€²è¡Œç¸®æ”¾ï¼ˆä¿ç•™åŸå§‹å°ºåº¦ï¼‰
    return pc
```

### 6.3 å‰ç«¯è¼ªè©¢æ©Ÿåˆ¶

```typescript
// frontend/src/pages/ProcessingDashboard.tsx
const handleProcess = async (projectId: string) => {
  // 1. è§¸ç™¼è™•ç†ä»»å‹™
  await api.post(`/api/v1/projects/${projectId}/process`);
  
  // 2. é–‹å§‹è¼ªè©¢é …ç›®ç‹€æ…‹
  const pollInterval = setInterval(async () => {
    const project = await api.get(`/api/v1/projects/${projectId}`);
    
    if (!project.is_processing) {
      // è™•ç†å®Œæˆ
      clearInterval(pollInterval);
      message.success('è™•ç†å·²å®Œæˆï¼');
      loadPendingAnnotations();  // åˆ·æ–°åˆ—è¡¨
    }
  }, 2000);  // æ¯ 2 ç§’è¼ªè©¢ä¸€æ¬¡
};
```

---

## 7. ç–‘é›£æ’è§£

### 7.1 å¸¸è¦‹éŒ¯èª¤

#### å•é¡Œ: `No module named 'FETCdataLoader'`

**è§£æ±ºæ–¹æ¡ˆ**:
```bash
cd PointNet
python train_classification.py ...
```

ç¢ºä¿åœ¨ `PointNet` ç›®éŒ„ä¸‹åŸ·è¡Œï¼Œæˆ–ä½¿ç”¨æ•´åˆè…³æœ¬ã€‚

---

#### å•é¡Œ: NPZ æ–‡ä»¶æ ¼å¼éŒ¯èª¤

**ç—‡ç‹€**: 
```
KeyError: 'pts'
```

**è§£æ±ºæ–¹æ¡ˆ**:
æª¢æŸ¥å°å‡ºçš„ NPZ æ–‡ä»¶ï¼š
```python
import numpy as np
data = np.load('vehicle_type_00000.npz')
print(data.files)  # æ‡‰åªåŒ…å« ['pts']
print(data['pts'].shape)  # (N, 3)
```

PointNet ç‰ˆæœ¬**ä¸éœ€è¦** `car_type` æ¬„ä½ï¼Œæ¨™ç±¤å¾ç›®éŒ„åç¨±è®€å–ã€‚

---

#### å•é¡Œ: ç›®éŒ„çµæ§‹éŒ¯èª¤

**ç—‡ç‹€**:
```
FileNotFoundError: [Errno 2] No such file or directory: '.../train'
```

**è§£æ±ºæ–¹æ¡ˆ**:
ç¢ºä¿ç›®éŒ„çµæ§‹æ­£ç¢ºï¼š
```bash
# æ­£ç¢ºçµæ§‹
data_dir/
  vehicle_type/
    train/
      vehicle_type_00000.npz
    test/
      vehicle_type_00000.npz

# éŒ¯èª¤çµæ§‹ï¼ˆç¼ºå°‘ train/test å­ç›®éŒ„ï¼‰
data_dir/
  vehicle_type/
    vehicle_type_00000.npz
```

---

#### å•é¡Œ: GPU è¨˜æ†¶é«”ä¸è¶³

**ç—‡ç‹€**:
```
RuntimeError: CUDA out of memory
```

**è§£æ±ºæ–¹æ¡ˆ**:
1. æ¸›å° batch_size:
   ```bash
   python train_classification.py --batch_size 16 ...
   ```
2. æ¸›å°‘é»æ•¸:
   ```bash
   python train_classification.py --num_point 512 ...
   ```
3. ä½¿ç”¨ CPU:
   ```bash
   python train_classification.py --use_cpu ...
   ```

---

#### å•é¡Œ: è¨“ç·´æº–ç¢ºç‡ä¸æå‡

**å¯èƒ½åŸå› **:
1. æ•¸æ“šä¸å¹³è¡¡
2. æ•¸æ“šè³ªé‡å•é¡Œ
3. å­¸ç¿’ç‡éé«˜/éä½
4. æ¨¡å‹éæ“¬åˆ/æ¬ æ“¬åˆ

**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥é¡åˆ¥åˆ†ä½ˆ:
   ```python
   from collections import Counter
   labels = [ann.vehicle_type.name for ann in annotations]
   print(Counter(labels))
   ```
2. èª¿æ•´å­¸ç¿’ç‡:
   ```bash
   python train_classification.py --learning_rate 0.0001 ...
   ```
3. å¢åŠ æ•¸æ“šå¢å¼·:
   - åœ¨ `FETCdataLoader` ä¸­å•Ÿç”¨æ—‹è½‰ã€ç¸®æ”¾ç­‰
4. æ—©åœ (Early Stopping):
   - ç›£æ§é©—è­‰é›†æº–ç¢ºç‡ï¼Œé¿å…éæ“¬åˆ

---

### 7.2 æ—¥èªŒæŸ¥çœ‹

```bash
# æŸ¥çœ‹ Celery worker æ—¥èªŒ
docker logs -f etc_celery_worker_dev

# æŸ¥çœ‹å¾Œç«¯ API æ—¥èªŒ
docker logs -f etc_api_dev

# æŸ¥çœ‹è¨“ç·´æ—¥èªŒ
cat PointNet/log/classification/pointnet_cls_fetc/logs/pointnet_cls.txt
```

---

## 8. æ€§èƒ½å„ªåŒ–å»ºè­°

### 8.1 æ•¸æ“šè™•ç†å„ªåŒ–

| é¡åˆ¥æ•¸ | æ¯é¡æ¨™è¨»æ•¸ | é ä¼°è™•ç†æ™‚é–“ | å»ºè­° |
|--------|-----------|------------|------|
| 2-3    | 100-500   | 10-30 ç§’    | æ¨™æº–é…ç½® |
| 3-5    | 500-1000  | 30-60 ç§’    | è€ƒæ…®å¢åŠ  Celery worker |
| 5-10   | 1000+     | 1-2 åˆ†é˜    | ä½¿ç”¨å¤š worker + Redis å„ªåŒ– |

### 8.2 è¨“ç·´å„ªåŒ–

| GPU | Batch Size | Epoch | é ä¼°è¨“ç·´æ™‚é–“ (1000 æ¨£æœ¬) |
|-----|-----------|-------|------------------------|
| RTX 3060 | 24 | 200 | 1-2 å°æ™‚ |
| RTX 3080 | 32 | 200 | 30-60 åˆ†é˜ |
| RTX 3090 | 48 | 200 | 20-40 åˆ†é˜ |
| CPU (i7) | 16 | 200 | 8-12 å°æ™‚ |

### 8.3 å»ºè­°é…ç½®

**å°å‹é …ç›®** (< 500 æ¨™è¨»):
```bash
python train_classification.py \
  --batch_size 16 \
  --epoch 100 \
  --num_point 512 \
  --process_data
```

**ä¸­å‹é …ç›®** (500-2000 æ¨™è¨»):
```bash
python train_classification.py \
  --batch_size 24 \
  --epoch 200 \
  --num_point 1024 \
  --process_data
```

**å¤§å‹é …ç›®** (> 2000 æ¨™è¨»):
```bash
python train_classification.py \
  --batch_size 32 \
  --epoch 300 \
  --num_point 2048 \
  --process_data \
  --sampler farthest  # æ›´å¥½çš„æ¡æ¨£è³ªé‡
```

---

## 9. ç¸½çµ

### âœ… å·²å®Œæˆçš„æ•´åˆ

1. âœ… æ•¸æ“šæ ¼å¼å®Œå…¨å…¼å®¹ PointNet çš„ FETCdataLoader
2. âœ… è‡ªå‹•åŒ–çš„æ•¸æ“šå°å‡ºæµç¨‹ï¼ˆCelery éåŒæ­¥ä»»å‹™ï¼‰
3. âœ… å‰ç«¯å¯¦æ™‚ç‹€æ…‹åé¥‹ï¼ˆè¼ªè©¢æ©Ÿåˆ¶ï¼‰
4. âœ… 90/10 train/test åˆ†å‰²
5. âœ… å¾ 00000 é–‹å§‹çš„é€£çºŒç·¨è™Ÿ
6. âœ… åªåŒ…å« 'pts' æ¬„ä½çš„ NPZ æ–‡ä»¶
7. âœ… æ•´åˆè¨“ç·´è…³æœ¬ (`train_model.py`)
8. âœ… å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„

### ğŸ¯ ä¸‹ä¸€æ­¥è¡Œå‹•

1. **æ¸¬è©¦æ•´åˆ**:
   ```bash
   # 1. æ¨™è¨»ä¸€äº›æ•¸æ“š
   # 2. åœ¨è™•ç†ä¸­å¿ƒåŸ·è¡Œè™•ç†
   # 3. æª¢æŸ¥å°å‡ºçš„æ•¸æ“šæ ¼å¼
   # 4. åŸ·è¡Œè¨“ç·´
   cd PointNet
   python train_classification.py --data_dir /path/to/exports/... --epoch 10
   ```

2. **é©—è­‰æ•¸æ“šè³ªé‡**:
   - ä½¿ç”¨ `INTEGRATION_CHECKLIST.md` é€²è¡Œå®Œæ•´æª¢æŸ¥
   - ç¢ºèªæª”åã€ç›®éŒ„çµæ§‹ã€NPZ å…§å®¹éƒ½æ­£ç¢º

3. **ç›£æ§è¨“ç·´**:
   - è§€å¯Ÿè¨“ç·´æ›²ç·š
   - èª¿æ•´è¶…åƒæ•¸
   - è¨˜éŒ„æœ€ä½³é…ç½®

---

## é™„éŒ„

### A. ç›¸é—œæ–‡ä»¶

- `INTEGRATION_CHECKLIST.md`: æ•´åˆæª¢æŸ¥æ¸…å–®
- `backend/app/worker.py`: æ•¸æ“šå°å‡ºé‚è¼¯
- `backend/train_model.py`: è¨“ç·´æ•´åˆè…³æœ¬
- `PointNet/data_utils/FETCdataLoader.py`: æ•¸æ“šåŠ è¼‰å™¨
- `PointNet/train_classification.py`: è¨“ç·´è…³æœ¬

### B. å¿«é€Ÿåƒè€ƒå‘½ä»¤

```bash
# å°å‡ºæ•¸æ“šï¼ˆé€éå‰ç«¯ UIï¼‰
# è™•ç†ä¸­å¿ƒ â†’ é¸æ“‡é …ç›® â†’ é–‹å§‹è™•ç†

# è¨“ç·´æ¨¡å‹
cd PointNet
python train_classification.py \
  --data_dir /path/to/exports/project_xxx \
  --log_dir pointnet_cls_fetc \
  --epoch 200 \
  --gpu 0 \
  --process_data \
  --clear_log

# æ¸¬è©¦æ¨¡å‹
python test_classification.py \
  --data_dir /path/to/exports/project_xxx \
  --log_dir pointnet_cls_fetc

# æŸ¥çœ‹æ—¥èªŒ
ls -la log/classification/pointnet_cls_fetc/
```

### C. è¯çµ¡è³‡è¨Š

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. æ—¥èªŒæª”æ¡ˆ
2. `INTEGRATION_CHECKLIST.md`
3. æœ¬æ–‡ä»¶çš„ç–‘é›£æ’è§£ç« ç¯€

---

**æœ€å¾Œæ›´æ–°**: 2026-01-14
**ç‰ˆæœ¬**: v2.0 (PointNet æ­£ç¢ºç‰ˆæœ¬)
